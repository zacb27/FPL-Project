{% extends "base.html" %}

{% block title %}FPL Vibe - Player Analysis{% endblock %}

{% block content %}
<div class="header-section">
    <h2>Top Players by Position</h2>
    <p class="subtitle">Find the best value players in Fantasy Premier League</p>
</div>

<!-- Filters -->
<div class="filters-card">
    <h3>Filters</h3>
    <form method="GET" action="{{ url_for('index') }}" class="filter-form">
        <div class="form-group">
            <label for="min_minutes">Minimum Minutes:</label>
            <input type="number" id="min_minutes" name="min_minutes" value="{{ min_minutes }}" min="0" step="50">
        </div>
        <div class="form-group">
            <label for="max_cost">Max Cost (£):</label>
            <input type="number" id="max_cost" name="max_cost" value="{{ max_cost or '' }}" min="0" max="15" step="0.5" placeholder="No limit">
        </div>
        <button type="submit" class="btn-primary">Apply Filters</button>
        <a href="{{ url_for('index') }}" class="btn-secondary">Reset</a>
    </form>
</div>

<!-- Position Tabs -->
<div class="position-tabs">
    {% for pos_id, pos_name in positions.items() %}
    <div class="position-section" id="position-{{ pos_id }}">
        <div class="position-header">
            <h3>{{ pos_name }}s</h3>
            <a href="{{ url_for('position_page', position_name=pos_name) }}" class="view-all-link">View All →</a>
        </div>
        
        {% if position_data[pos_name] %}
        <div class="table-container">
            <table class="players-table">
                <thead>
                    <tr>
                        {% for key in position_data[pos_name][0].keys() %}
                        <th>{{ key.replace('_', ' ').title() }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for player in position_data[pos_name] %}
                    <tr>
                        {% for key, value in player.items() %}
                        <td>
                            {% if key == 'Cost' %}
                                £{{ "%.1f"|format(value|float) }}
                            {% elif key in ['PPM', 'PPG', 'Points_per_90', 'Goals_per_90', 'Assists_per_90', 'G+A_per_90', 'Clean_Sheets_per_90', 'Saves_per_90'] %}
                                {% if value is not none and value != '' %}{{ "%.2f"|format(value|float) }}{% else %}-{% endif %}
                            {% elif key == 'Ownership %' %}
                                {% if value is not none and value != '' %}{{ "%.1f"|format(value|float) }}%{% else %}-{% endif %}
                            {% else %}
                                {{ value if value is not none else '-' }}
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-data">No players found with the specified criteria.</p>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endblock %}

